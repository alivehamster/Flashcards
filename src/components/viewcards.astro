---
import { pool } from "../libs/db";
import type { Card, Deck } from "../assets/types";

const deckId = Astro.props.deckId as number;
const userid = await Astro.session?.get("userid");
let cards: Card[] = [];

if (userid) {
  const deck = await pool
    .execute("SELECT * FROM Decks WHERE DeckId = ?", [deckId])
    .then(([rows]) => (rows as Deck[])[0]);

  if (deck && Number(userid) === deck.UserId) {
    const [rows] = await pool.execute(
      "SELECT CardId, Front, Back FROM Cards WHERE DeckId = ?",
      [deck.DeckId]
    );
    cards = rows as Card[];
  }
}
---

<div data-cards={JSON.stringify(cards)}>
  {
    cards.map((card) => (
      <div class="flex flex-col p-2 bg-gray-400 rounded-xl w-5/6 h-40 justify-center my-2">
        <h2 class="text-gray-700 text-sm">Card ID: {card.CardId}</h2>
        <div class="flex justify-between">
          <p class="text-black text-3xl w-1/2 text-center break-words">
            {card.Front}
          </p>
          <p class="text-black text-3xl w-1/2 text-center break-words">
            {card.Back}
          </p>
        </div>
      </div>
    ))
  }
</div>

<script>
  console.log((document.querySelector('div[data-cards]') as HTMLElement)?.dataset.cards);
</script>